<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QuickDesk - Admin Panel</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { font-family: 'Poppins', sans-serif; }
    .sidebar {
      background: linear-gradient(145deg, #2563eb 0%, #3b82f6 100%);
      color: #fff;
    }
    .sidebar a { color: #c7d2fe; transition: color 0.2s; }
    .sidebar a:hover { color: #fff; }
    .active-link { color: #fff; font-weight: 600; }
    .card {
      background: #fff;
      box-shadow: 0 4px 24px 0 rgba(59,130,246,0.08);
      border-radius: 1rem;
      transition: box-shadow 0.2s;
    }
    .card:hover { box-shadow: 0 8px 32px 0 rgba(59,130,246,0.16); }
    .badge { font-size: 0.75rem; padding: 0.25rem 0.75rem; border-radius: 9999px; }
    .badge-admin { background: #dbeafe; color: #2563eb; }
    .badge-agent { background: #dcfce7; color: #16a34a; }
    .badge-user { background: #fef9c3; color: #ca8a04; }
    .badge-open { background: #dbeafe; color: #2563eb; }
    .badge-pending { background: #fef3c7; color: #d97706; }
    .badge-closed { background: #dcfce7; color: #16a34a; }
    .badge-high { background: #fee2e2; color: #dc2626; }
    .badge-medium { background: #fef3c7; color: #d97706; }
    .badge-low { background: #e0f2fe; color: #0369a1; }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #fff;
      min-width: 160px;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
      z-index: 1;
      border-radius: 0.5rem;
    }
    .dropdown:hover .dropdown-content {
      display: block;
    }
    .animate-pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
  </style>
</head>
<body class="bg-blue-50 min-h-screen flex">
  <!-- Sidebar -->
  <aside class="sidebar w-64 min-h-screen flex flex-col p-6">
    <div class="flex items-center gap-3 mb-10">
      <img src="assets/logo.svg" alt="QuickDesk Logo" class="w-10 h-10">
      <span class="text-2xl font-bold tracking-tight">QuickDesk</span>
    </div>
    <nav class="flex-1 space-y-2">
      <a href="dashboard.html" class="flex items-center gap-2 py-2 px-3 rounded transition"><svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M13 5v6h6"/></svg> Dashboard</a>
      <a href="ticket-create.html" class="flex items-center gap-2 py-2 px-3 rounded transition"><svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg> Create Ticket</a>
      <a href="#" class="active-link flex items-center gap-2 py-2 px-3 rounded transition"><svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5.121 17.804A13.937 13.937 0 0112 15c2.485 0 4.797.657 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0z"/></svg> Admin Panel</a>
      <a href="#" class="flex items-center gap-2 py-2 px-3 rounded transition"><svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg> Reports</a>
      <a href="#" class="flex items-center gap-2 py-2 px-3 rounded transition"><svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg> Settings</a>
    </nav>
    <div class="mt-auto flex items-center gap-3 pt-6 border-t border-blue-200">
      <img src="assets/user-avatar.svg" alt="User Avatar" class="w-10 h-10 rounded-full">
      <div>
        <div class="font-semibold">John Doe</div>
        <div class="text-xs text-blue-100">Admin</div>
      </div>
      <button onclick="logout()" class="ml-auto bg-white/20 hover:bg-white/40 text-white px-3 py-1 rounded transition">Logout</button>
    </div>
  </aside>
  <!-- Main Content -->
  <main class="flex-1 p-8 overflow-y-auto scrollbar-hide">
    <div class="mb-8 flex items-center justify-between">
      <h1 class="text-3xl font-bold text-gray-800">Admin Panel</h1>
      <div class="flex items-center gap-4">
        <div class="relative">
          <input type="text" id="globalSearch" placeholder="Search..." class="pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          <i class="fas fa-search absolute left-3 top-2.5 text-gray-400"></i>
        </div>
      </div>
    </div>
    
    <!-- Stats Overview -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
      <div class="card p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-500">Total Users</p>
            <h3 id="totalUsers" class="text-3xl font-bold mt-1 animate-pulse">--</h3>
          </div>
          <div class="p-3 rounded-full bg-blue-100 text-blue-600">
            <i class="fas fa-users"></i>
          </div>
        </div>
      </div>
      
      <div class="card p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-500">Active Tickets</p>
            <h3 id="activeTickets" class="text-3xl font-bold mt-1 animate-pulse">--</h3>
          </div>
          <div class="p-3 rounded-full bg-green-100 text-green-600">
            <i class="fas fa-ticket-alt"></i>
          </div>
        </div>
      </div>
      
      <div class="card p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-500">New Today</p>
            <h3 id="newToday" class="text-3xl font-bold mt-1 animate-pulse">--</h3>
          </div>
          <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
            <i class="fas fa-clock"></i>
          </div>
        </div>
      </div>
      
      <div class="card p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-500">Avg. Response</p>
            <h3 id="avgResponse" class="text-3xl font-bold mt-1 animate-pulse">--</h3>
          </div>
          <div class="p-3 rounded-full bg-purple-100 text-purple-600">
            <i class="fas fa-comment-dots"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- User Management -->
    <div class="card p-8 mb-8">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-semibold">User Management</h2>
        <div class="flex items-center gap-3">
          <div class="relative">
            <input type="text" id="userSearch" placeholder="Search users..." class="pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <i class="fas fa-search absolute left-3 top-2.5 text-gray-400"></i>
          </div>
          <div class="dropdown relative">
            <button class="px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 flex items-center">
              Actions <i class="fas fa-chevron-down ml-2 text-xs"></i>
            </button>
            <div class="dropdown-content p-2">
              <button id="bulkDeleteUsers" class="w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 rounded">Delete Selected</button>
              <button id="exportUsers" class="w-full text-left px-4 py-2 text-gray-700 hover:bg-gray-50 rounded">Export to CSV</button>
            </div>
          </div>
          <button id="addUserBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700">
            <i class="fas fa-plus mr-2"></i> Add User
          </button>
        </div>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead>
            <tr class="text-gray-500 text-left">
              <th class="py-2 px-4 w-10"><input type="checkbox" id="selectAllUsers"></th>
              <th class="py-2 px-4">Name</th>
              <th class="py-2 px-4">Email</th>
              <th class="py-2 px-4">Role</th>
              <th class="py-2 px-4">Last Active</th>
              <th class="py-2 px-4">Actions</th>
            </tr>
          </thead>
          <tbody id="userTable">
            <!-- Users will be loaded here -->
          </tbody>
        </table>
      </div>
      <div class="flex items-center justify-between mt-4">
        <div class="text-sm text-gray-500" id="userPaginationInfo">Showing 0 to 0 of 0 entries</div>
        <div class="flex items-center gap-2">
          <button id="prevUserPage" class="px-3 py-1 border border-gray-300 rounded disabled:opacity-50" disabled>Previous</button>
          <div id="userPageNumbers" class="flex items-center gap-1"></div>
          <button id="nextUserPage" class="px-3 py-1 border border-gray-300 rounded disabled:opacity-50" disabled>Next</button>
        </div>
      </div>
    </div>
    
    <!-- Ticket Management -->
    <div class="card p-8 mb-8">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-semibold">Ticket Management</h2>
        <div class="flex items-center gap-3">
          <div class="relative">
            <input type="text" id="ticketSearch" placeholder="Search tickets..." class="pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <i class="fas fa-search absolute left-3 top-2.5 text-gray-400"></i>
          </div>
          <select id="ticketStatusFilter" class="border border-gray-200 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <option value="">All Statuses</option>
            <option value="open">Open</option>
            <option value="pending">Pending</option>
            <option value="closed">Closed</option>
          </select>
          <button id="exportTickets" class="px-4 py-2 bg-white border border-gray-300 rounded-lg font-medium hover:bg-gray-50">
            <i class="fas fa-download mr-2"></i> Export
          </button>
        </div>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead>
            <tr class="text-gray-500 text-left">
              <th class="py-2 px-4">#</th>
              <th class="py-2 px-4">Title</th>
              <th class="py-2 px-4">Status</th>
              <th class="py-2 px-4">Priority</th>
              <th class="py-2 px-4">Created By</th>
              <th class="py-2 px-4">Created</th>
              <th class="py-2 px-4">Actions</th>
            </tr>
          </thead>
          <tbody id="adminTicketTable">
            <!-- Tickets will be loaded here -->
          </tbody>
        </table>
      </div>
      <div class="flex items-center justify-between mt-4">
        <div class="text-sm text-gray-500" id="ticketPaginationInfo">Showing 0 to 0 of 0 entries</div>
        <div class="flex items-center gap-2">
          <button id="prevTicketPage" class="px-3 py-1 border border-gray-300 rounded disabled:opacity-50" disabled>Previous</button>
          <div id="ticketPageNumbers" class="flex items-center gap-1"></div>
          <button id="nextTicketPage" class="px-3 py-1 border border-gray-300 rounded disabled:opacity-50" disabled>Next</button>
        </div>
      </div>
    </div>
    
    <!-- System Logs -->
    <div class="card p-8">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold">System Logs</h2>
        <div class="flex items-center gap-2">
          <select id="logLevelFilter" class="border border-gray-200 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <option value="">All Levels</option>
            <option value="info">Info</option>
            <option value="warning">Warning</option>
            <option value="error">Error</option>
          </select>
          <button id="clearLogs" class="px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg">
            <i class="fas fa-trash mr-1"></i> Clear Logs
          </button>
        </div>
      </div>
      <div class="bg-gray-50 rounded-lg p-4 max-h-96 overflow-y-auto">
        <ul id="systemLogs" class="space-y-3 text-sm text-gray-600">
          <!-- Logs will be loaded here -->
        </ul>
      </div>
    </div>
  </main>
  
  <!-- Add User Modal -->
  <div id="addUserModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-xl p-6 w-full max-w-md">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-bold">Add New User</h3>
        <button id="closeAddUserModal" class="text-gray-400 hover:text-gray-600">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <form id="addUserForm" class="space-y-4">
        <div>
          <label for="newUserName" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
          <input type="text" id="newUserName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div>
          <label for="newUserEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
          <input type="email" id="newUserEmail" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div>
          <label for="newUserRole" class="block text-sm font-medium text-gray-700 mb-1">Role</label>
          <select id="newUserRole" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <option value="">Select Role</option>
            <option value="Admin">Admin</option>
            <option value="Agent">Agent</option>
            <option value="User">User</option>
          </select>
        </div>
        <div>
          <label for="newUserPassword" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
          <input type="password" id="newUserPassword" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div class="flex justify-end gap-3 pt-4">
          <button type="button" id="cancelAddUser" class="px-4 py-2 border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50">
            Cancel
          </button>
          <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700">
            Add User
          </button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Edit User Modal -->
  <div id="editUserModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-xl p-6 w-full max-w-md">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-bold">Edit User</h3>
        <button id="closeEditUserModal" class="text-gray-400 hover:text-gray-600">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <form id="editUserForm" class="space-y-4">
        <input type="hidden" id="editUserId">
        <div>
          <label for="editUserName" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
          <input type="text" id="editUserName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div>
          <label for="editUserEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
          <input type="email" id="editUserEmail" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div>
          <label for="editUserRole" class="block text-sm font-medium text-gray-700 mb-1">Role</label>
          <select id="editUserRole" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <option value="Admin">Admin</option>
            <option value="Agent">Agent</option>
            <option value="User">User</option>
          </select>
        </div>
        <div class="flex justify-end gap-3 pt-4">
          <button type="button" id="cancelEditUser" class="px-4 py-2 border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50">
            Cancel
          </button>
          <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700">
            Save Changes
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Current state
    let users = [];
    let tickets = [];
    let logs = [];
    let currentUserPage = 1;
    let currentTicketPage = 1;
    const itemsPerPage = 10;
    
    // DOM Elements
    const userTable = document.getElementById('userTable');
    const adminTicketTable = document.getElementById('adminTicketTable');
    const systemLogs = document.getElementById('systemLogs');
    const totalUsersEl = document.getElementById('totalUsers');
    const activeTicketsEl = document.getElementById('activeTickets');
    const newTodayEl = document.getElementById('newToday');
    const avgResponseEl = document.getElementById('avgResponse');
    const userSearch = document.getElementById('userSearch');
    const ticketSearch = document.getElementById('ticketSearch');
    const ticketStatusFilter = document.getElementById('ticketStatusFilter');
    const logLevelFilter = document.getElementById('logLevelFilter');
    const selectAllUsers = document.getElementById('selectAllUsers');
    const bulkDeleteUsers = document.getElementById('bulkDeleteUsers');
    const exportUsers = document.getElementById('exportUsers');
    const addUserBtn = document.getElementById('addUserBtn');
    const exportTickets = document.getElementById('exportTickets');
    const clearLogs = document.getElementById('clearLogs');
    const userPaginationInfo = document.getElementById('userPaginationInfo');
    const ticketPaginationInfo = document.getElementById('ticketPaginationInfo');
    const prevUserPage = document.getElementById('prevUserPage');
    const nextUserPage = document.getElementById('nextUserPage');
    const prevTicketPage = document.getElementById('prevTicketPage');
    const nextTicketPage = document.getElementById('nextTicketPage');
    const userPageNumbers = document.getElementById('userPageNumbers');
    const ticketPageNumbers = document.getElementById('ticketPageNumbers');
    
    // Modal elements
    const addUserModal = document.getElementById('addUserModal');
    const editUserModal = document.getElementById('editUserModal');
    const closeAddUserModal = document.getElementById('closeAddUserModal');
    const closeEditUserModal = document.getElementById('closeEditUserModal');
    const cancelAddUser = document.getElementById('cancelAddUser');
    const cancelEditUser = document.getElementById('cancelEditUser');
    const addUserForm = document.getElementById('addUserForm');
    const editUserForm = document.getElementById('editUserForm');
    
    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      fetchData();
      setupEventListeners();
    });
    
    // Fetch all data
    async function fetchData() {
      try {
        // Fetch users
        const usersResponse = await fetch('http://localhost:5000/api/users', {
          headers: {
            'Authorization': 'Bearer AdminToken'
          }
        });
        const usersData = await usersResponse.json();
        users = usersData.data || usersData;
        
        // Fetch tickets
        const ticketsResponse = await fetch('http://localhost:5000/api/tickets', {
          headers: {
            'Authorization': 'Bearer AdminToken'
          }
        });
        const ticketsData = await ticketsResponse.json();
        tickets = ticketsData.data || ticketsData;
        
        // Fetch logs
        const logsResponse = await fetch('http://localhost:5000/api/logs', {
          headers: {
            'Authorization': 'Bearer AdminToken'
          }
        });
        const logsData = await logsResponse.json();
        logs = logsData.data || logsData;
        
        // Update UI
        updateStats();
        renderUserTable();
        renderTicketTable();
        renderSystemLogs();
      } catch (error) {
        console.error('Error fetching data:', error);
        alert('Failed to load data. Please try again.');
      }
    }
    
    // Update stats
    function updateStats() {
      totalUsersEl.textContent = users.length;
      totalUsersEl.classList.remove('animate-pulse');
      
      const activeTickets = tickets.filter(t => t.status === 'Open' || t.status === 'Pending').length;
      activeTicketsEl.textContent = activeTickets;
      activeTicketsEl.classList.remove('animate-pulse');
      
      const today = new Date().toISOString().split('T')[0];
      const newToday = tickets.filter(t => t.created.includes(today)).length;
      newTodayEl.textContent = newToday;
      newTodayEl.classList.remove('animate-pulse');
      
      avgResponseEl.textContent = '2h 15m';
      avgResponseEl.classList.remove('animate-pulse');
    }
    
    // Render user table
    function renderUserTable(filteredUsers = users) {
      const startIndex = (currentUserPage - 1) * itemsPerPage;
      const paginatedUsers = filteredUsers.slice(startIndex, startIndex + itemsPerPage);
      
      userTable.innerHTML = paginatedUsers.map(user => `
        <tr class="border-b last:border-0 hover:bg-gray-50">
          <td class="py-3 px-4"><input type="checkbox" class="user-checkbox" data-id="${user.id}"></td>
          <td class="py-3 px-4 font-medium">${user.name}</td>
          <td class="py-3 px-4">${user.email}</td>
          <td class="py-3 px-4">
            <span class="badge ${user.role === 'Admin' ? 'badge-admin' : user.role === 'Agent' ? 'badge-agent' : 'badge-user'}">${user.role}</span>
          </td>
          <td class="py-3 px-4 text-gray-500">Just now</td>
          <td class="py-3 px-4">
            <button class="edit-user-btn text-blue-600 hover:text-blue-800 mr-3" data-id="${user.id}">
              <i class="fas fa-edit"></i>
            </button>
            <button class="delete-user-btn text-red-600 hover:text-red-800" data-id="${user.id}">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      `).join('');
      
      // Update pagination info
      const totalPages = Math.ceil(filteredUsers.length / itemsPerPage);
      userPaginationInfo.textContent = `Showing ${startIndex + 1} to ${Math.min(startIndex + itemsPerPage, filteredUsers.length)} of ${filteredUsers.length} entries`;
      
      // Update pagination buttons
      prevUserPage.disabled = currentUserPage === 1;
      nextUserPage.disabled = currentUserPage === totalPages;
      
      // Update page numbers
      userPageNumbers.innerHTML = '';
      for (let i = 1; i <= totalPages; i++) {
        const pageBtn = document.createElement('button');
        pageBtn.textContent = i;
        pageBtn.className = `px-3 py-1 rounded ${i === currentUserPage ? 'bg-blue-600 text-white' : 'border border-gray-300'}`;
        pageBtn.addEventListener('click', () => {
          currentUserPage = i;
          renderUserTable(filteredUsers);
        });
        userPageNumbers.appendChild(pageBtn);
      }
      
      // Add event listeners to edit/delete buttons
      document.querySelectorAll('.edit-user-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const userId = parseInt(e.currentTarget.getAttribute('data-id'));
          openEditUserModal(userId);
        });
      });
      
      document.querySelectorAll('.delete-user-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const userId = parseInt(e.currentTarget.getAttribute('data-id'));
          deleteUser(userId);
        });
      });
    }
    
    // Render ticket table
    function renderTicketTable(filteredTickets = tickets) {
      const startIndex = (currentTicketPage - 1) * itemsPerPage;
      const paginatedTickets = filteredTickets.slice(startIndex, startIndex + itemsPerPage);
      
      adminTicketTable.innerHTML = paginatedTickets.map(ticket => `
        <tr class="border-b last:border-0 hover:bg-gray-50">
          <td class="py-3 px-4">${ticket.id}</td>
          <td class="py-3 px-4 font-medium">${ticket.title}</td>
          <td class="py-3 px-4">
            <span class="badge ${ticket.status === 'Open' ? 'badge-open' : ticket.status === 'Closed' ? 'badge-closed' : 'badge-pending'}">${ticket.status}</span>
          </td>
          <td class="py-3 px-4">
            <span class="badge ${ticket.priority === 'High' ? 'badge-high' : ticket.priority === 'Medium' ? 'badge-medium' : 'badge-low'}">${ticket.priority}</span>
          </td>
          <td class="py-3 px-4">${ticket.createdBy || 'N/A'}</td>
          <td class="py-3 px-4">${ticket.created}</td>
          <td class="py-3 px-4">
            <a href="ticket-details.html?id=${ticket.id}" class="text-blue-600 hover:text-blue-800 mr-3">
              <i class="fas fa-eye"></i>
            </a>
            <button class="delete-ticket-btn text-red-600 hover:text-red-800" data-id="${ticket.id}">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      `).join('');
      
      // Update pagination info
      const totalPages = Math.ceil(filteredTickets.length / itemsPerPage);
      ticketPaginationInfo.textContent = `Showing ${startIndex + 1} to ${Math.min(startIndex + itemsPerPage, filteredTickets.length)} of ${filteredTickets.length} entries`;
      
      // Update pagination buttons
      prevTicketPage.disabled = currentTicketPage === 1;
      nextTicketPage.disabled = currentTicketPage === totalPages;
      
      // Update page numbers
      ticketPageNumbers.innerHTML = '';
      for (let i = 1; i <= totalPages; i++) {
        const pageBtn = document.createElement('button');
        pageBtn.textContent = i;
        pageBtn.className = `px-3 py-1 rounded ${i === currentTicketPage ? 'bg-blue-600 text-white' : 'border border-gray-300'}`;
        pageBtn.addEventListener('click', () => {
          currentTicketPage = i;
          renderTicketTable(filteredTickets);
        });
        ticketPageNumbers.appendChild(pageBtn);
      }
      
      // Add event listeners to delete buttons
      document.querySelectorAll('.delete-ticket-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const ticketId = parseInt(e.currentTarget.getAttribute('data-id'));
          deleteTicket(ticketId);
        });
      });
    }
    
    // Render system logs
    function renderSystemLogs(filteredLogs = logs) {
      systemLogs.innerHTML = filteredLogs.slice(-50).reverse().map(log => `
        <li class="flex items-start">
          <div class="flex-shrink-0 mt-1 mr-3">
            ${log.includes('error') ? '<i class="fas fa-exclamation-circle text-red-500"></i>' : 
              log.includes('warning') ? '<i class="fas fa-exclamation-triangle text-yellow-500"></i>' : 
              '<i class="fas fa-info-circle text-blue-500"></i>'}
          </div>
          <div class="flex-1">
            <div class="text-sm">${log}</div>
            <div class="text-xs text-gray-400 mt-1">${new Date().toLocaleString()}</div>
          </div>
        </li>
      `).join('');
    }
    
    // Setup event listeners
    function setupEventListeners() {
      // User search
      userSearch.addEventListener('input', () => {
        const searchTerm = userSearch.value.toLowerCase();
        const filteredUsers = users.filter(user => 
          user.name.toLowerCase().includes(searchTerm) || 
          user.email.toLowerCase().includes(searchTerm)
        );
        currentUserPage = 1;
        renderUserTable(filteredUsers);
      });
      
      // Ticket search
      ticketSearch.addEventListener('input', () => {
        const searchTerm = ticketSearch.value.toLowerCase();
        const statusFilter = ticketStatusFilter.value.toLowerCase();
        
        const filteredTickets = tickets.filter(ticket => {
          const matchesSearch = ticket.title.toLowerCase().includes(searchTerm) || 
                              (ticket.description && ticket.description.toLowerCase().includes(searchTerm));
          const matchesStatus = !statusFilter || ticket.status.toLowerCase() === statusFilter;
          return matchesSearch && matchesStatus;
        });
        
        currentTicketPage = 1;
        renderTicketTable(filteredTickets);
      });
      
      // Ticket status filter
      ticketStatusFilter.addEventListener('change', () => {
        ticketSearch.dispatchEvent(new Event('input'));
      });
      
      // Log level filter
      logLevelFilter.addEventListener('change', () => {
        const level = logLevelFilter.value.toLowerCase();
        const filteredLogs = level ? logs.filter(log => log.toLowerCase().includes(level)) : logs;
        renderSystemLogs(filteredLogs);
      });
      
      // Select all users checkbox
      selectAllUsers.addEventListener('change', (e) => {
        document.querySelectorAll('.user-checkbox').forEach(checkbox => {
          checkbox.checked = e.target.checked;
        });
      });
      
      // Bulk delete users
      bulkDeleteUsers.addEventListener('click', () => {
        const selectedUserIds = Array.from(document.querySelectorAll('.user-checkbox:checked'))
          .map(checkbox => parseInt(checkbox.getAttribute('data-id')));
        
        if (selectedUserIds.length === 0) {
          alert('Please select at least one user to delete');
          return;
        }
        
        if (confirm(`Are you sure you want to delete ${selectedUserIds.length} selected users?`)) {
          deleteUsers(selectedUserIds);
        }
      });
      
      // Export users
      exportUsers.addEventListener('click', () => {
        alert('Export functionality would be implemented here');
      });
      
      // Add user button
      addUserBtn.addEventListener('click', () => {
        addUserModal.classList.remove('hidden');
      });
      
      // Close add user modal
      closeAddUserModal.addEventListener('click', () => {
        addUserModal.classList.add('hidden');
      });
      
      cancelAddUser.addEventListener('click', () => {
        addUserModal.classList.add('hidden');
      });
      
      // Close edit user modal
      closeEditUserModal.addEventListener('click', () => {
        editUserModal.classList.add('hidden');
      });
      
      cancelEditUser.addEventListener('click', () => {
        editUserModal.classList.add('hidden');
      });
      
      // Add user form submission
      addUserForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const newUser = {
          name: document.getElementById('newUserName').value,
          email: document.getElementById('newUserEmail').value,
          role: document.getElementById('newUserRole').value,
          password: document.getElementById('newUserPassword').value
        };
        
        try {
          const response = await fetch('http://localhost:5000/api/users', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(newUser)
          });
          
          if (response.ok) {
            const addedUser = await response.json();
            users.push(addedUser);
            addUserModal.classList.add('hidden');
            addUserForm.reset();
            renderUserTable();
            updateStats();
            alert('User added successfully');
          } else {
            throw new Error('Failed to add user');
          }
        } catch (error) {
          console.error('Error adding user:', error);
          alert('Failed to add user. Please try again.');
        }
      });
      
      // Edit user form submission
      editUserForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const userId = parseInt(document.getElementById('editUserId').value);
        const updatedUser = {
          name: document.getElementById('editUserName').value,
          email: document.getElementById('editUserEmail').value,
          role: document.getElementById('editUserRole').value
        };
        
        try {
          const response = await fetch(`http://localhost:5000/api/users/${userId}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(updatedUser)
          });
          
          if (response.ok) {
            const user = await response.json();
            const index = users.findIndex(u => u.id === userId);
            if (index !== -1) {
              users[index] = user;
            }
            editUserModal.classList.add('hidden');
            renderUserTable();
            alert('User updated successfully');
          } else {
            throw new Error('Failed to update user');
          }
        } catch (error) {
          console.error('Error updating user:', error);
          alert('Failed to update user. Please try again.');
        }
      });
      
      // Export tickets
      exportTickets.addEventListener('click', () => {
        alert('Export functionality would be implemented here');
      });
      
      // Clear logs
      clearLogs.addEventListener('click', () => {
        if (confirm('Are you sure you want to clear all system logs?')) {
          clearAllLogs();
        }
      });
      
      // Pagination buttons
      prevUserPage.addEventListener('click', () => {
        if (currentUserPage > 1) {
          currentUserPage--;
          renderUserTable();
        }
      });
      
      nextUserPage.addEventListener('click', () => {
        const totalPages = Math.ceil(users.length / itemsPerPage);
        if (currentUserPage < totalPages) {
          currentUserPage++;
          renderUserTable();
        }
      });
      
      prevTicketPage.addEventListener('click', () => {
        if (currentTicketPage > 1) {
          currentTicketPage--;
          renderTicketTable();
        }
      });
      
      nextTicketPage.addEventListener('click', () => {
        const totalPages = Math.ceil(tickets.length / itemsPerPage);
        if (currentTicketPage < totalPages) {
          currentTicketPage++;
          renderTicketTable();
        }
      });
    }
    
    // Open edit user modal
    function openEditUserModal(userId) {
      const user = users.find(u => u.id === userId);
      if (user) {
        document.getElementById('editUserId').value = user.id;
        document.getElementById('editUserName').value = user.name;
        document.getElementById('editUserEmail').value = user.email;
        document.getElementById('editUserRole').value = user.role;
        editUserModal.classList.remove('hidden');
      }
    }
    
    // Delete user
    async function deleteUser(userId) {
      if (confirm('Are you sure you want to delete this user?')) {
        try {
          const response = await fetch(`http://localhost:5000/api/users/${userId}`, {
            method: 'DELETE'
          });
          
          if (response.ok) {
            users = users.filter(user => user.id !== userId);
            renderUserTable();
            updateStats();
            alert('User deleted successfully');
          } else {
            throw new Error('Failed to delete user');
          }
        } catch (error) {
          console.error('Error deleting user:', error);
          alert('Failed to delete user. Please try again.');
        }
      }
    }
    
    // Delete multiple users
    async function deleteUsers(userIds) {
      try {
        // In a real app, you would send a bulk delete request to the API
        // For this demo, we'll delete one by one
        for (const userId of userIds) {
          await fetch(`http://localhost:5000/api/users/${userId}`, {
            method: 'DELETE'
          });
        }
        
        // Update local state
        users = users.filter(user => !userIds.includes(user.id));
        renderUserTable();
        updateStats();
        selectAllUsers.checked = false;
        alert(`${userIds.length} users deleted successfully`);
      } catch (error) {
        console.error('Error deleting users:', error);
        alert('Failed to delete some users. Please try again.');
      }
    }
    
    // Delete ticket
    async function deleteTicket(ticketId) {
      if (confirm('Are you sure you want to delete this ticket?')) {
        try {
          const response = await fetch(`http://localhost:5000/api/tickets/${ticketId}`, {
            method: 'DELETE'
          });
          
          if (response.ok) {
            tickets = tickets.filter(ticket => ticket.id !== ticketId);
            renderTicketTable();
            updateStats();
            alert('Ticket deleted successfully');
          } else {
            throw new Error('Failed to delete ticket');
          }
        } catch (error) {
          console.error('Error deleting ticket:', error);
          alert('Failed to delete ticket. Please try again.');
        }
      }
    }
    
    // Clear all logs
    async function clearAllLogs() {
      try {
        // In a real app, you would send a request to clear logs
        // For this demo, we'll just clear the local state
        logs = [];
        renderSystemLogs();
        alert('System logs cleared');
      } catch (error) {
        console.error('Error clearing logs:', error);
        alert('Failed to clear logs. Please try again.');
      }
    }
    
    // Logout
    function logout() {
      localStorage.removeItem('isAuthenticated');
      window.location.href = 'login.html';
    }
  </script>
</body>
</html>